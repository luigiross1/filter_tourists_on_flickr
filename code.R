install.packages("maptools")
install.packages("rgeos")
install.packages("sp")
install.packages("lubridate")
install.packages("ggplot2")
install.packages("ggmap")
install.packages("gstat")
install.packages("OpenStreetMap")
library(maptools)
library(ggplot2) 
library(OpenStreetMap) 
library(sp) 
library(rgeos) 
library(lubridate)
library(gstat)
library(ggmap)

#load the Flickr data
flickr<- read.csv("D:\\UCL\\Dissertation\\modelling airbnb offer\\flickr_nyc.csv")

#classify pictures by year and month
flickr$date_taken=stri_datetime_parse(flickr$date_taken,format="uuuu-MM")
flickr$date_taken<-as.Date(flickr$date_taken,format("%y/%m"))
flickr$month<-month(flickr$date_taken)
flickr$year<-year(flickr$date_taken)

#pick just one year
flickr_2009<-subset(flickr,flickr$year==2009)

#pick the users
users<-data.frame(flickr_2009$user_nickname,flickr_2009$month)
users<-unique(users)

#separate the users by month
m1<-subset(users,users$flickr_2009.month==1)
m2<-subset(users,users$flickr_2009.month==2)
m3<-subset(users,users$flickr_2009.month==3)
m4<-subset(users,users$flickr_2009.month==4)
m5<-subset(users,users$flickr_2009.month==5)
m6<-subset(users,users$flickr_2009.month==6)
m7<-subset(users,users$flickr_2009.month==7)
m8<-subset(users,users$flickr_2009.month==8)
m9<-subset(users,users$flickr_2009.month==9)
m10<-subset(users,users$flickr_2009.month==10)
m11<-subset(users,users$flickr_2009.month==11)
m12<-subset(users,users$flickr_2009.month==12)
m1$flickr_2009.month<-NULL
m2$flickr_2009.month<-NULL
m3$flickr_2009.month<-NULL
m4$flickr_2009.month<-NULL
m5$flickr_2009.month<-NULL
m6$flickr_2009.month<-NULL
m7$flickr_2009.month<-NULL
m8$flickr_2009.month<-NULL
m9$flickr_2009.month<-NULL
m10$flickr_2009.month<-NULL
m11$flickr_2009.month<-NULL
m12$flickr_2009.month<-NULL

#make comparisons among the 12 months
c1<-merge(m1,m2,all=FALSE)
c2<-merge(m1,m3,all=FALSE)
c3<-merge(m1,m4,all=FALSE)
c4<-merge(m1,m5,all=FALSE)
c5<-merge(m1,m6,all=FALSE)
c6<-merge(m1,m7,all=FALSE)
c7<-merge(m1,m8,all=FALSE)
c8<-merge(m1,m9,all=FALSE)
c9<-merge(m1,m10,all=FALSE)
c10<-merge(m1,m11,all=FALSE)
c11<-merge(m1,m12,all=FALSE)
c12<-merge(m2,m3,all=FALSE)
c13<-merge(m2,m4,all=FALSE)
c14<-merge(m2,m5,all=FALSE)
c15<-merge(m2,m6,all=FALSE)
c16<-merge(m2,m7,all=FALSE)
c17<-merge(m2,m8,all=FALSE)
c18<-merge(m2,m9,all=FALSE)
c19<-merge(m2,m10,all=FALSE)
c20<-merge(m2,m11,all=FALSE)
c21<-merge(m2,m12,all=FALSE)
c22<-merge(m3,m4,all=FALSE)
c23<-merge(m3,m5,all=FALSE)
c24<-merge(m3,m6,all=FALSE)
c25<-merge(m3,m7,all=FALSE)
c26<-merge(m3,m8,all=FALSE)
c27<-merge(m3,m9,all=FALSE)
c28<-merge(m3,m10,all=FALSE)
c29<-merge(m3,m11,all=FALSE)
c30<-merge(m3,m12,all=FALSE)
c31<-merge(m4,m5,all=FALSE)
c32<-merge(m4,m6,all=FALSE)
c33<-merge(m4,m7,all=FALSE)
c34<-merge(m4,m8,all=FALSE)
c35<-merge(m4,m9,all=FALSE)
c36<-merge(m4,m10,all=FALSE)
c37<-merge(m4,m11,all=FALSE)
c38<-merge(m4,m12,all=FALSE)
c39<-merge(m5,m6,all=FALSE)
c40<-merge(m5,m7,all=FALSE)
c41<-merge(m5,m8,all=FALSE)
c42<-merge(m5,m9,all=FALSE)
c43<-merge(m5,m10,all=FALSE)
c44<-merge(m5,m11,all=FALSE)
c45<-merge(m5,m12,all=FALSE)
c46<-merge(m6,m7,all=FALSE)
c47<-merge(m6,m8,all=FALSE)
c48<-merge(m6,m9,all=FALSE)
c49<-merge(m6,m10,all=FALSE)
c50<-merge(m6,m11,all=FALSE)
c51<-merge(m6,m12,all=FALSE)
c52<-merge(m7,m8,all=FALSE)
c53<-merge(m7,m9,all=FALSE)
c54<-merge(m7,m10,all=FALSE)
c55<-merge(m7,m11,all=FALSE)
c56<-merge(m7,m12,all=FALSE)
c57<-merge(m8,m9,all=FALSE)
c58<-merge(m8,m10,all=FALSE)
c59<-merge(m8,m11,all=FALSE)
c60<-merge(m8,m12,all=FALSE)
c61<-merge(m9,m10,all=FALSE)
c62<-merge(m9,m11,all=FALSE)
c63<-merge(m9,m12,all=FALSE)
c64<-merge(m10,m11,all=FALSE)
c65<-merge(m10,m12,all=FALSE)
c66<-merge(m11,m12,all=FALSE)

#all users in the 66 datasets created above are local users. Sum all of them
locals<-merge(c1,c2,all=TRUE)
locals<-merge(locals,c3,all=TRUE)
locals<-merge(locals,c4,all=TRUE)
locals<-merge(locals,c5,all=TRUE)
locals<-merge(locals,c6,all=TRUE)
locals<-merge(locals,c7,all=TRUE)
locals<-merge(locals,c8,all=TRUE)
locals<-merge(locals,c9,all=TRUE)
locals<-merge(locals,c10,all=TRUE)
locals<-merge(locals,c11,all=TRUE)
locals<-merge(locals,c12,all=TRUE)
locals<-merge(locals,c13,all=TRUE)
locals<-merge(locals,c14,all=TRUE)
locals<-merge(locals,c15,all=TRUE)
locals<-merge(locals,c16,all=TRUE)
locals<-merge(locals,c17,all=TRUE)
locals<-merge(locals,c18,all=TRUE)
locals<-merge(locals,c19,all=TRUE)
locals<-merge(locals,c20,all=TRUE)
locals<-merge(locals,c22,all=TRUE)
locals<-merge(locals,c23,all=TRUE)
locals<-merge(locals,c24,all=TRUE)
locals<-merge(locals,c25,all=TRUE)
locals<-merge(locals,c26,all=TRUE)
locals<-merge(locals,c27,all=TRUE)
locals<-merge(locals,c28,all=TRUE)
locals<-merge(locals,c29,all=TRUE)
locals<-merge(locals,c30,all=TRUE)
locals<-merge(locals,c31,all=TRUE)
locals<-merge(locals,c32,all=TRUE)
locals<-merge(locals,c33,all=TRUE)
locals<-merge(locals,c34,all=TRUE)
locals<-merge(locals,c35,all=TRUE)
locals<-merge(locals,c36,all=TRUE)
locals<-merge(locals,c37,all=TRUE)
locals<-merge(locals,c38,all=TRUE)
locals<-merge(locals,c39,all=TRUE)
locals<-merge(locals,c40,all=TRUE)
locals<-merge(locals,c41,all=TRUE)
locals<-merge(locals,c42,all=TRUE)
locals<-merge(locals,c43,all=TRUE)
locals<-merge(locals,c44,all=TRUE)
locals<-merge(locals,c45,all=TRUE)
locals<-merge(locals,c46,all=TRUE)
locals<-merge(locals,c47,all=TRUE)
locals<-merge(locals,c48,all=TRUE)
locals<-merge(locals,c49,all=TRUE)
locals<-merge(locals,c50,all=TRUE)
locals<-merge(locals,c51,all=TRUE)
locals<-merge(locals,c52,all=TRUE)
locals<-merge(locals,c53,all=TRUE)
locals<-merge(locals,c54,all=TRUE)
locals<-merge(locals,c55,all=TRUE)
locals<-merge(locals,c56,all=TRUE)
locals<-merge(locals,c57,all=TRUE)
locals<-merge(locals,c58,all=TRUE)
locals<-merge(locals,c59,all=TRUE)
locals<-merge(locals,c60,all=TRUE)
locals<-merge(locals,c61,all=TRUE)
locals<-merge(locals,c62,all=TRUE)
locals<-merge(locals,c63,all=TRUE)
locals<-merge(locals,c64,all=TRUE)
locals<-merge(locals,c65,all=TRUE)
locals<-merge(locals,c66,all=TRUE)
colnames(locals)<- c("user_nickname")
locals$locals<-"local"

#label each picture if it has been shot by a local or by a tourist and generate the dataframe for the tourists
flickr_2009$locals<-NULL
flickr_2009<-merge(flickr_2009,locals,all=TRUE)
flickr_2009[is.na(flickr_2009)]<-'tourist'
pictures_tourists<-subset(flickr_2009,flickr_2009$locals=='tourist')
write.csv(pictures_tourists, file = "tourists.csv")
